NOTE: Please send any corrections/bugs/typos in this manual and any other part
of UNMACRO to chojnacki@vaxmfg.tech.nwu.edu.  Thank you.

                           UNMACRO - A Disassembler

0 Introduction

This is not even a beta release of UNMACRO.  I have this funny feeling that
there are many bugs and problems with it but I hope that through correspondance
I can correct them.  The user interface is somewhat like the VAX/VMS debugger
in that it takes commands of the form "SET BYTE ...", etcetera.

1 Features

	o Creates output that can be assembled by MACRO (I hope)
	o Lets you disassemble for a while, save your session, exit, and
	  at a later time you can pick up where you left off
	o Symbolic addresses for CALLS and CALLG instructions
	o Default symbol table includes calls to the P1 system vector table
	o Automatically labels any addresses referenced by branch, jump, and
	  subroutine calls.  It automatically puts a .ENTRY on addresses
	  referenced by CALLS and CALLG instructions
	o Interprets the image header if you so desire via STATS command.
	o DUMP format listings of the header any other part of the image via
	  the HEADER and DUMP commands.
	o On-line help
	o Ability to search for a string of bytes in the image

2 Commands

2.1 DISASSEMBLE - Disassembles an instruction or data value

  Format:

    DISASSEMBLE entity

  where entity is either a mask-type, UNTIL, or ALL

    UNTIL - Disassmebles until the program counter (pc):

      END  - reaches the end of the image
      PC   - is greater than or equal to a value
      DATA - reaches a non-instruction byte

    ALL - Disassemble starting at the base of the image and going until the end.

2.2 DUMP - Display the next 256 byte in a dump format

2.3 HEADER - Display the image header in a dump format

2.4 GOTO - Set the pc to a new value

  Format:

    GOTO address

2.5 QUIT - Exit the program

2.6 SAVE-UNSAVE - Store and recall the image mask.  The image mask is a byte
  array the same size as the image that specifies whether the byte it
  corresponds to is an instruction or a data value of some sort.

2.7 SEARCH - Search the image, starting at the current pc and going until the
  string is found or until the end of the image is reached.

2.8 SET-SHOW - Force part of the image to be a particular data type/display
  the data type at the current pc.

  Format:

    SET entity mask-type

  Valid entities:

    BYTE - Force the next byte to be interpreted as the mask-type given.
    WORD - Force the next 2 bytes to be interpreted as the mask-type given.
    LONG - Force the next 4 bytes to be interpreted as the mask-type given.
    QUAD - Force the next 8 bytes to be interpreted as the mask-type given.
    OCTA - Force the next 16 bytes to be interpreted as the mask-type given.
    RANGE - Force the next n bytes to be interpreted as the mask-type given.

      Format:

        SET RANGE mask-type count

      Where count is the number of bytes to force to be interpreted as the
      mask-type specifies.  Note: count is a hexadecimal number.

  Mask-Types - These are the different types of masks that may be placed on top
  of the image to force how it will be disassembled:

    UNDEFINED - The byte will not be interpreted.
    INSTRUCTION - The byte will be interpreted as an instruction.
    BYTE - The byte will be interpreted as a .BYTE directive.
    WORD - The byte will be interpreted as a .WORD directive.
    LONG - The byte will be interpreted as a .LONG directive.
    QUAD - The byte will be interpreted as a .QUAD directive.
    OCTA - The byte will be interpreted as a .OCTA directive.
    F_FLOATING - The byte will be interpreted as a .F_FLOATING directive.
    D_FLOATING - The byte will be interpreted as a .D_FLOATING directive.
    G_FLOATING - The byte will be interpreted as a .G_FLOATING directive.
    H_FLOATING - The byte will be interpreted as a .H_FLOATING directive.
    ASCII - The byte will be interpreted as a .ASCII directive.
    ASCIC - The byte will be interpreted as a .ASCIC directive.
    ASCID - The byte will be interpreted as a .ASCID directive.
    ASCIZ - The byte will be interpreted as a .ASCIZ directive.
    BLKB - The byte will be interpreted as a .BLKB directive.
    BLKW - The byte will be interpreted as a .BLKW directive.
    BLKL - The byte will be interpreted as a .BLKL directive.
    BLKQ - The byte will be interpreted as a .BLKQ directive.
    BLKO - The byte will be interpreted as a .BLKO directive.
    ADDRESS - The byte will be interpreted as a .ADDRESS directive.
    MASK - The byte will be interpreted as a .MASK directive.
    ENTRY - The byte will be interpreted as a .ENTRY directive.

  Set also can do the following:

  Format:

    SET command

  Where valid commands are:

    LABEL - When the byte is disassembled, there will be a label preceding it of
            the form:

      laddress:

      For example: if the byte at pc 200 was labeled, then, when it is
      disassembled, it would appear as follows:

        l200:   .byte  x^025

    UNLABEL - Removes a label set by SET LABEL.

2.9 STATS
  Displays important information such as transfer addresses, image base,
  etc.

2.10 WRITE - Disassembles the entire image and sends the output to a file.

2.11 SYMBOL - Lets you define symbols, display, and remove

  Format:

    SYMBOL command

  Valid commands are:

    DEFINE - Define a symbol name.
    LIST - Lists all symbols in the symbol table.
    REMOVE - Removes a symbol from the symbol table.

3 Example

$ unmacro
Image file: unmacro.exe
75 blocks found in unmacro.exe.
Is there an image header? y
First transfer address = 7ffedf68
Second transfer address = 00003600
base, top = 00000200, 00009600
00000200> stats
Stats for image unmacro.exe
;header statistics:
;	header size = 168. bytes
;	offsets to b, c, d, e = 0030, 0044, 0058, 0000
;	major id = 3230, minor id = 3530
;	number of header blocks = 1.
;	image type, priv mask = 01, ffffffff, ffffffff
;	i/o channels = 0., i/o seg pages = 0.
;	image flags = 01000028, gsid = 0696872d, sys version = 00000000
;	    PICIMG
;	    DBGDMT
;	transfer addresses = 7ffedf68, 00003600, 00000000
;image section descriptors:
;    isd 0
;	size = 0010 pages = 001a starting vpn = 0001 pfc = 00
;	flags = 0000008a base vbn = 0002
;	    Copy on reference
;	    Writable
;	    Last cluster in P0 space
;    isd 1
;	size = 0010 pages = 0028 starting vpn = 001b pfc = 00
;	flags = 00000080 base vbn = 001c
;	    Last cluster in P0 space
;    isd 2
;	size = 0010 pages = 0002 starting vpn = 0043 pfc = 00
;	flags = 0000040a base vbn = 0044
;	    Copy on reference
;	    Writable
;	    Fixup vector
;    isd 3
;	size = 000c pages = 0014 starting vpn = ffec pfc = 00
;	flags = fd00008c
;	    Demand zero
;	    Writable
;	    Last cluster in P0 space
;    isd 4
;	size = 0020 pages = 0004 starting vpn = 0000 pfc = 00
;	flags = 03000021 base vbn = 0000
;	    Global section
;	gsid = 04000002 name = 'VAXCRTL_001'
;    isd 5
;	size = 001f pages = 0042 starting vpn = 0000 pfc = 00
;	flags = 03000021 base vbn = 0000
;	    Global section
;	gsid = 01000064 name = 'FORRTL_001'
;    isd 6
;	size = 001f pages = 00b0 starting vpn = 0000 pfc = 00
;	flags = 03000021 base vbn = 0000
;	    Global section
;	gsid = 0100000e name = 'LIBRTL_001'
;    isd 7
;	size = 001f pages = 008e starting vpn = 0000 pfc = 00
;	flags = 03000021 base vbn = 0000
;	    Global section
;	gsid = 8100800c name = 'MTHRTL_001'
;    isd 8
;	size = 001f pages = 00c1 starting vpn = 0000 pfc = 00
;	flags = 03000021 base vbn = 0000
;	    Global section
;	gsid = 01000066 name = 'SMGSHR_001'
00000200> header
header block 0

35 30 32 30 00 00 00 00 00 58 00 44 00 30 00 a8  (.0.D.X.....0205 00000000
00 00 00 00 ff ff ff ff ff ff ff ff 00 00 01 01  ................ 00000010
00 00 86 00 00 00 00 00 06 96 87 2d 01 00 00 28  (...-........... 00000020
00 00 00 00 00 00 00 00 00 00 36 00 7f fe df 68  h_~..6.......... 00000030
00 00 00 06 00 00 00 00 00 00 00 46 00 00 00 00  ....F........... 00000040
4f 52 43 41 4d 4e 55 07 00 00 00 00 00 00 00 00  .........UNMACRO 00000050
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00000060
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00000070
00 00 00 00 00 00 00 00 00 00 00 30 2e 31 56 04  .V1.0........... 00000080
00 00 32 30 2d 35 30 05 00 92 06 96 87 2d 26 a0   &-......05-02.. 00000090
00 00 00 01 00 1a 00 10 00 00 00 00 00 00 00 00  ................ 000000a0
00 00 00 1b 00 28 00 10 00 00 00 02 00 00 00 8a  ..........(..... 000000b0
00 00 00 43 00 02 00 10 00 00 00 1c 00 00 00 80  ............C... 000000c0
00 3f ff ec 00 14 00 0c 00 00 00 44 00 00 04 0a  ....D.......l.?. 000000d0
03 00 00 21 00 00 00 00 00 04 00 20 fd 00 00 8c  ...} .......!... 000000e0
4c 54 52 43 58 41 56 0b 04 00 00 02 00 00 00 00  .........VAXCRTL 000000f0
03 00 00 21 00 00 00 00 00 42 00 1f 31 30 30 5f  _001..B.....!... 00000100
5f 4c 54 52 52 4f 46 0a 01 00 00 64 00 00 00 00  ....d....FORRTL_ 00000110
00 03 00 00 21 00 00 00 00 00 b0 00 1f 31 30 30  001..0.....!.... 00000120
30 5f 4c 54 52 42 49 4c 0a 01 00 00 0e 00 00 00  ........LIBRTL_0 00000130
00 00 03 00 00 21 00 00 00 00 00 8e 00 1f 31 30  01........!..... 00000140
30 30 5f 4c 54 52 48 54 4d 0a 81 00 80 0c 00 00  .......MTHRTL_00 00000150
00 00 00 03 00 00 21 00 00 00 00 00 c1 00 1f 31  1..A.....!...... 00000160
31 30 30 5f 52 48 53 47 4d 53 0a 01 00 00 66 00  .f....SMGSHR_001 00000170
ff ff ff ff ff ff ff ff ff ff ff ff ff ff 00 00  ................ 00000180
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 00000190
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001a0
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001b0
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001c0
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001d0
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001e0
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff  ................ 000001f0
00000200> goto 3600
00003600> set word .entry
Syntax error for SET BYTE/LONG... (argument 1)
Valid arguments are:
UNDEFINED INSTRUCTION BYTE WORD LONG QUAD OCTA F_FLOATING D_FLOATING 
G_FLOATING H_FLOATING ASCII ASCIC ASCID ASCIZ BLKB BLKW BLKL BLKQ 
BLKO ADDRESS MASK ENTRY 
00003600> set word entry
00003600> 
	.entry	l3600,^m<r2,r3,r4,r5,r6,r7,r8,r9,r10,r11>
00003602> 
	movab	w^^x0fed8(sp),sp		;3602
00003607> 
	jsb	@l^^x866c		;3607
0000360d> 
	movab	l^^x200,r3		;360d
00003614> 
	movab	l^^x24e8,r5		;3614
0000361b> 
	movab	l^^x22c4,r8		;361b
00003622> 
	movab	l^^x2488,r9		;3622
00003629> 
	movab	l^^x35a8,r10		;3629
00003630> 
	movab	l^^x22c0,r6		;3630
00003637> 
	movab	@l^^x86c0,r11		;3637
0000363e> 
	movab	@l^^x86c4,r7		;363e
00003645> 
	movw	s^#^x24,b^^x0cc(fp)		;3645
00003649> 
	movb	s^#^xe,b^^x0ce(fp)		;3649
0000364d> 
	movb	s^#^x1,b^^x0cf(fp)		;364d
00003651> 
	moval	(r3),b^^x0d0(fp)		;3651
00003655> 
	pushal	b^^x025(r3)		;3655
00003658> 
	pushl	(r11)		;3658
0000365a>
	calls	s^#^x2,@l^^x8690		;365a
00003661> go 8690
00008690> disassemble long
	.long	^x0000007c
00008690> dump
00 00 00 a4 00 00 01 44 00 00 01 04 00 00 00 7c  |.......D...$... 00008690
00 00 06 e4 00 00 01 cc 00 00 03 fc 00 00 00 ac  ,...|...L...d... 000086a0
00 00 00 00 00 00 05 18 00 00 00 03 00 00 00 01  ................ 000086b0
00 00 09 74 00 00 0a 38 00 00 0a 30 00 00 0a 2c  ,...0...8...t... 000086c0
00 00 00 00 00 0d 00 02 00 00 84 00 00 00 00 01  ................ 000086d0
00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00  ............@... 000086e0
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 000086f0
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008700
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008710
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008720
00 00 00 00 4c 54 52 43 58 41 56 07 00 00 00 00  .....VAXCRTL.... 00008730
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008740
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008750
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008760
00 00 00 00 00 4c 54 52 52 4f 46 06 00 00 00 00  .....FORRTL..... 00008770
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 00008780
00008690> help
  Information available:

  DISASSEMBLE           DUMP       GOTO       HEADER     Introduction
  Mask-Types QUIT       SAVE-UNSAVE           SEARCH     SET-SHOW   STATS
  SYMBOL     WRITE

Topic?
00008690> 
l8690:	.long	^x0000007c
00008694> shoe
Syntax error for UNMACRO> (argument 0)
Valid arguments are:
DISASSEMBLE SET SHOW QUIT GOTO SAVE UNSAVE DUMP STATS SEARCH HEADER 
HELP WRITE SYMBOL 
00008694> show
INSTRUCTION

00008694> go 8690
00008690> show long
LONG (labeled)

00008690> 
l8690:	.long	^x0000007c
00008c2e> quit

4 Known Bugs

    o DISASSEMBLE ALL may get stuck at a byte whose type is UNDEFINED
    o SYMBOL REMOVE does not work yet
    o SEARCH is a little goofy (does not quite work correctly)